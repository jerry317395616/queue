<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.api.mapper.CardMapper">


    <select id="getCardNo" resultType="java.util.Map">

        SELECT cr.code_reg cardRegCode,
               pi.id_no credentialNo,
               cr.name_reg regName,
               cr.dt_sex sex,
               CASE
                   WHEN cr.dt_sex = '02' THEN '男'
                   ELSE '女'
                   END AS gender,
               cr.birth_day birthDay,
               cr.tel_no teleNo,
               cr.mpi mpi,
               cr.pk_pi,
               cr.address_code addressCode,
               cr.detailed_address detailedAddress,
               cr.postcode postCode,
               cc.card_no cardNo,
               cc.status cardStatus,
               acc.AMT_ACC,
               pi.NAME_PI,
               FLOOR(MONTHS_BETWEEN(SYSDATE, TO_DATE(SUBSTR(pi.id_no, 7, 8), 'YYYYMMDD')) / 12) AS age
        FROM card_reginfo cr
                 left join VIEW_HIS_PI_MASTER pi on cr.pk_pi = pi.pk_pi
                 left join card_e_card cc on cr.pk_reginfo = cc.pk_reginfo
                 left join PSC_PI_ACC acc on acc.PK_PI = cr.PK_PI and acc.DEL_FLAG = '0'
        where cc.card_no =  #{cardNo}

    </select>
</mapper>